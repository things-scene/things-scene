!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=Object.assign({},t)}return n(e,[{key:"creator",value:function(e,t,r){r(Error("not implemented yet"))}},{key:"disposer",value:function(e,t){}},{key:"provider",get:function(){return this._provider||(this._provider=new scene.ReferenceMap(this.creator.bind(this),this.disposer.bind(this))),this._provider}},{key:"modelAccessor",get:function(){return void 0==this.options.modelAccessor?"model":this.options.modelAccessor}}]),e}();t.default=o},function(e,t,r){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0});var o=s(r(3)),i=s(r(0));function s(e){return e&&e.__esModule?e:{default:e}}e.exports={SceneIntegrator:o.default,SceneProvider:i.default},t.default=e.exports,"undefined"!=typeof window&&(window.SceneIntegrator=o.default,window.SceneProvider=i.default),void 0!==n&&(n.SceneIntegrator=o.default,n.SceneProvider=i.default)}).call(t,r(2))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(0)),i=s(r(4));function s(e){return e&&e.__esModule?e:{default:e}}function a(e){var t,r;if((t="string"==typeof e?document.getElementById(e):e).children&&t.children.length>0)for(var n in t.children){var o=t.children[n];if("scene-wrapper"==o.getAttribute("class")){r=o;break}}return r||(r=function(){var e=document.createElement("div");return e.style.width=e.style.height="100%",e.style.position="relative",e.setAttribute("class","scene-wrapper"),e}(),t.appendChild(r)),t=r}var c={local:s(r(5)).default,"things-board-server":i.default},u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=Object.assign({},t);var r=t.fit,n=t.license,i=t.sceneProvider,s=void 0===i?"things-board-server":i;if("string"==typeof s){var a=e.getProvider(s);this.sceneProvider=a&&new a(t).provider}else{if(!(s instanceof o.default))return void console.error("Improper sceneProvider : ",s);this.sceneProvider=s}this.fitMode=r,scene&&scene.license(n)}return n(e,null,[{key:"instance",value:function(t){return this._instance||(this._instance=new e(t)),this._instance}},{key:"help",value:function(e){e||console.info("\n      ")}},{key:"registerProvider",value:function(e,t){c[e]?console.error("scene provider ("+e+") already registered."):c[e]=t}},{key:"getProvider",value:function(e){return c[e]}}]),n(e,[{key:"integrate",value:function(e){var t=e.target,r=e.sceneName,n=e.callback;this.show(r,t,n)}},{key:"fit",value:function(e,t){t.fit(e||this.fitMode)}},{key:"show",value:function(e,t,r){if(t&&(t=a(t),this._releaseRef(t)),e){var n=this;this.sceneProvider.get(e,!0).then(function(e){e.target!==t?(t&&(e.target=t,n._bindAllEvents(e._container,n),n.fit(n.fitMode,e)),r&&r.call(null,e)):e.release()},function(e){r&&r.call(null,scene,e)})}}},{key:"_releaseRef",value:function(e){e&&e.scene&&(this._unbindAllEvents(e.scene._container,this),e.scene.release(),e.scene.target=null,e.scene.dispose(),delete e.scene)}},{key:"_bindAllEvents",value:function(e,t){for(var r in this.eventMap)if(this.eventMap.hasOwnProperty(r)){var n=this[this.eventMap[r]];e.on(r,n,t)}}},{key:"_unbindAllEvents",value:function(e,t){for(var r in this.eventMap)if(this.eventMap.hasOwnProperty(r)){var n=this[this.eventMap[r]];e.off(r,n,t)}}},{key:"fitMode",get:function(){return this._fitMode||"both"},set:function(e){this._fitMode=e}}]),e}();t.default=u},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_sceneProvider=__webpack_require__(0),_sceneProvider2=_interopRequireDefault(_sceneProvider);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function defaultBuilder(e,t){return e+"/scenes/"+t}var ThingsBoardServerProvider=function(_SceneProvider){function ThingsBoardServerProvider(){return _classCallCheck(this,ThingsBoardServerProvider),_possibleConstructorReturn(this,(ThingsBoardServerProvider.__proto__||Object.getPrototypeOf(ThingsBoardServerProvider)).apply(this,arguments))}return _inherits(ThingsBoardServerProvider,_SceneProvider),_createClass(ThingsBoardServerProvider,[{key:"creator",value:function(e,t,r){var n=this.options,o=n.baseURL,i=void 0===o?"http://localhost/rest":o,s=(n.withCredentials,n.authorizationKey),a=n.authorizationType,c=void 0===a?"token":a,u=n.urlBuilder,l=void 0===u?defaultBuilder:u,f=new XMLHttpRequest,d={"Content-Type":"application/json","Authorization-Type":c,"Authorization-Key":s};for(var p in f.onloadend=function(n){var o=n.srcElement;if(200!==o.status)return 401==o.status?v.handleUnauthorized():v.openResponseError(o.response),void r("cannot fetch resource: "+e+", status: "+o.status);var s=n.target.response;if(!s)return void r("cannot fetch resource: "+e+", status: "+o.status);v.provider.get(e).then(function(r){t(r),console.warn("Board fetched more than twice.",e)},function(n){try{var o=v.computeModel(s),a=scene.create({model:o,mode:0,refProvider:v.provider});a.app.baseUrl=i,t(a)}catch(n){r({message:"cannot create board: "+e,detail:n})}})},f.ontimeout=function(){r("Timeout occured while fetching board: "+e)},f.withCredentials=!0,f.responseType="json",f.timeout=3e4,f.open("GET",l(i,e),!0),d)f.setRequestHeader(p,d[p]);f.send();var v=this}},{key:"computeModel",value:function computeModel(info){var _options$modelAccesso=this.options.modelAccessor,modelAccessor=void 0===_options$modelAccesso?"model":_options$modelAccesso;return modelAccessor?JSON.parse(eval("info."+modelAccessor)):info}}]),ThingsBoardServerProvider}(_sceneProvider2.default);exports.default=ThingsBoardServerProvider},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),s=(n=i)&&n.__esModule?n:{default:n};var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"creator",value:function(e,t,r){var n=this.options.models[e];if(n){t(scene.create({model:n,mode:0,refProvider:this.provider}))}else r("cannot find model: "+e)}}]),t}();t.default=a}])});